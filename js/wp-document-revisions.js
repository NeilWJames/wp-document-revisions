!function(){function e(t,e){return function(){return t.apply(e,arguments)}}var i;function t(t){this.updateTimestamps=e(this.updateTimestamps,this),this.postAutosaveCallback=e(this.postAutosaveCallback,this),this.overrideLock=e(this.overrideLock,this),this.restoreRevision=e(this.restoreRevision,this),this.enableSubmit=e(this.enableSubmit,this),this.autosaveEnableButtons=e(this.autosaveEnableButtons,this),this.hijackAutosave=e(this.hijackAutosave,this),this.cookieFalse=e(this.cookieFalse,this),this.cookieTrue=e(this.cookieTrue,this),this.cookieDelete=e(this.cookieDelete,this),this.buildContent=e(this.buildContent,this),this.checkUpdate=e(this.checkUpdate,this),this.$=t,this.$(".revision").click(this.restoreRevision),this.$("#override_link").click(this.overrideLock),this.$("#document a").click(this.requestPermission),this.$(document).bind("autosaveComplete",this.postAutosaveCallback),this.$(document).bind("documentUpload",this.legacyPostDocumentUpload),this.$(":button, :submit","#submitpost").prop("disabled",!0),this.$("#misc-publishing-actions a").click(this.enableSubmit),this.$("input, select").on("change",this.enableSubmit),this.$("input[type=text], textarea").on("keyup",this.enableSubmit),this.$("#sample-permalink").on("change",this.enableSubmit),this.$("#content-add_media").click(this.cookieFalse),this.$("#postimagediv .inside").click(this.cookieTrue),this.$("#publishing-action").click(this.buildContent),this.$("#submitdiv .inside").click(this.cookieDelete),this.$("#adminmenumain").click(this.cookieDelete),this.$("#wpadminbar").click(this.cookieDelete),this.$("#document").show(),this.$("#revision-log").show(),this.$("#revision-summary").hide(),this.bindPostDocumentUploadCB(),this.hijackAutosave(),this.checkUpdate(),setInterval(this.updateTimestamps,6e4),setInterval(this.checkUpdate,1e3)}t.prototype.hasUpload=!1,t.prototype.secure="https:"===window.location.protocol,t.prototype.window=window.dialogArguments||opener||parent||top,t.prototype.hijackAutosave=function(){return this.autosaveEnableButtonsOriginal=window.autosave_enable_buttons,window.autosave_enable_buttons=this.autosaveEnableButtons},t.prototype.autosaveEnableButtons=function(){if(this.window.document.$(document).trigger("autosaveComplete"),this.hasUpload)return this.autosaveEnableButtonsOriginal()},t.prototype.enableSubmit=function(){return this.$("#revision-summary").show(),this.$(":button, :submit","#submitpost").removeAttr("disabled"),this.$("#lock_override").prev().fadeIn()},t.prototype.restoreRevision=function(t){if(t.preventDefault(),confirm(wp_document_revisions.restoreConfirmation))return window.location.href=this.$(t.target).attr("href")},t.prototype.overrideLock=function(){return this.$.post(ajaxurl,{action:"override_lock",post_id:this.$("#post_ID").val()||0,nonce:wp_document_revisions.nonce},function(t){return t?(this.$("#lock_override").hide(),this.$(".error").not("#lock-notice").hide(),this.$("#publish, .add_media, #lock-notice").fadeIn(),autosave()):alert(wp_document_revisions.lockError)})},t.prototype.requestPermission=function(){if(null!=window.webkitNotifications)return window.webkitNotifications.requestPermission()},t.prototype.lockOverrideNotice=function(t){return 0<window.webkitNotifications.checkPermission()?window.webkitNotifications.RequestPermission(lock_override_notice):window.webkitNotifications.createNotification(wp_document_revisions.lostLockNoticeLogo,wp_document_revisions.lostLockNoticeTitle,t).show()},t.prototype.postAutosaveCallback=function(){if(0<this.$("#autosave-alert").length&&0<this.$("#lock-notice").length&&this.$("#lock-notice").is(":visible"))return wp_document_revisions.lostLockNotice=wp_document_revisions.lostLockNotice.replace("%s",this.window.document.$("#title").val()),(window.webkitNotifications?lock_override_notice:alert)(wp_document_revisions.lostLockNotice),location.reload(!0)},t.prototype.legacyPostDocumentUpload=function(t,e){return this.postDocumentUpload(t,e)},t.prototype.human_time_diff=function(t,e){var i=new Date;return e=e||i.getTime()/1e3+parseInt(wp_document_revisions.offset),(i=Math.abs(e-t))<=3600?(e=Math.floor(i/60),(1===(e=this.roundUp(e))?wp_document_revisions.minute:wp_document_revisions.minutes).replace("%d",e)):i<=86400&&3600<i?(t=Math.floor(i/3600),(1===(t=this.roundUp(t))?wp_document_revisions.hour:wp_document_revisions.hours).replace("%d",t)):86400<=i?(e=Math.floor(i/86400),(1===(e=this.roundUp(e))?wp_document_revisions.day:wp_document_revisions.days).replace("%d",e)):void 0},t.prototype.roundUp=function(t){return t=t<1?1:t},t.prototype.bindPostDocumentUploadCB=function(){var o;if("undefined"!=typeof uploader&&null!==uploader)return uploader.bind("FileUploaded",(o=this,function(t,e,i){if(!i.response.match("media-upload-error"))return o.postDocumentUpload(e.name,i.response)}))},t.prototype.cookieFalse=function(){wpCookies.set("doc_image","false",3600,"/wp-admin",!1,this.secure)},t.prototype.cookieTrue=function(){wpCookies.set("doc_image","true",3600,"/wp-admin",!1,this.secure),this.$(":button, :submit","#submitpost").removeAttr("disabled")},t.prototype.cookieDelete=function(){wpCookies.set("doc_image","true",-60,"/wp-admin",!1,this.secure)},t.prototype.updateTimestamps=function(){return this.$(".timestamp").each((t=this,function(){return t.$(t).text(t.human_time_diff(t.$(t).attr("id")))}));var t},t.prototype.getDescr=function(){var t,e=this.window.document.getElementById("content_ifr");return null===e?void 0===(t=this.$("#post_content").val())||""===t||/^\d+$/.test(t)?"":t:void 0===(e=e.contentWindow.document.getElementById("tinymce").innerHTML)?""===(t=this.$("#post_content").val())||/^\d+$/.test(t)?"":t:(e=(e=e.replace(/<br data-mce-bogus=\"1\">/g,"")).replace(/<br><\/p>/g,"</p>")).replace(/<p>\s*<\/p>/g,"")},t.prototype.buildContent=function(){var t=this.$("#post_content").val(),e=this.getDescr(),i=""===t?[""]:/^\d+$/.test(t)?["\x3c!-- WPDR "+t+" --\x3e"]:t.match(/<!-- WPDR \s*\d+ -->/),e=e.replace(/<!-- WPDR \s*\d+ -->/,"");t!==(e=i[0]+e)&&this.enableSubmit(),this.window.jQuery("#curr_content").val(e),this.window.jQuery("#post_content").val(e),this.window.jQuery("#content").val(e)},t.prototype.postDocumentUpload=function(t,e){return"string"==typeof e&&-1!==e.indexOf("error")?this.$(".media-item:first").html(e):(t instanceof Object&&(t=t.name.split(".").pop()),!this.hasUpload&&(t=/\d+$/.exec(e),this.window.jQuery("#post_content").val("\x3c!-- WPDR "+t+" --\x3e"),this.window.jQuery("#message").hide(),this.hasUpload=!0,this.window.tb_remove(),this.window.jQuery("#post").before(wp_document_revisions.postUploadNotice).prev().fadeIn().fadeOut().fadeIn(),this.enableSubmit(),0!==this.window.jQuery("#sample-permalink").length)?this.window.jQuery("#sample-permalink").html(this.window.jQuery("#sample-permalink").html().replace(/\<\/span>(\.[a-z0-9]{1,7})?@$/i,wp_document_revisions.extension)):void 0)},t.prototype.checkUpdate=function(){var t,e=this.$("#curr_content").val();void 0!==e&&(t=this.$("#post_content").val(),"Unset"===e?(this.$(":button, :submit","#submitpost").prop("disabled",!0),this.$("#curr_content").val(t)):this.getDescr()===e&&t===e||(this.buildContent(),this.enableSubmit()))},i=t,jQuery(function(t){return window.WPDocumentRevisions=new i(t)})}.call(this);